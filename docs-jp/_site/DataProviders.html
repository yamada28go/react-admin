<!DOCTYPE html>
<html lang="en-US">
    <head>
        <title>React-admin - データフェッチング</title>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
        <meta name="description" content="" />
        <meta name="HandheldFriendly" content="true" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <link
            rel="canonical"
            href="/DataProviders.html"
        />
        <link
            rel="stylesheet"
            href="/css/materialize.min.css"
        />
        <link
            rel="stylesheet"
            href="/css/style-v19.css"
        />
        <link rel="stylesheet" href="/css/syntax.css" />
        <link rel="stylesheet" href="/css/prism.css" />
        <link rel="stylesheet" href="/css/tocbot.css" />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/icon?family=Material+Icons"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.css"
            integrity="sha512-2kqK5bWDwdrluTn6Wkj+jgiwyzvAHLirVp08Kz7kN5I8PWQ0tUtEMxfhyWDCrnws91BJ9PfrUy6ImfA7Qb22TA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
        <link
            rel="stylesheet"
            href="/css/docsearch.css"
        />
        <!-- Newsletter form -->
        <style>
            @font-face {
                font-display: block;
                font-family: Roboto;
                src: url(https://assets.brevo.com/font/Roboto/Latin/normal/normal/7529907e9eaf8ebb5220c5f9850e3811.woff2)
                        format('woff2'),
                    url(https://assets.brevo.com/font/Roboto/Latin/normal/normal/25c678feafdc175a70922a116c9be3e7.woff)
                        format('woff');
            }

            @font-face {
                font-display: fallback;
                font-family: Roboto;
                font-weight: 600;
                src: url(https://assets.brevo.com/font/Roboto/Latin/medium/normal/6e9caeeafb1f3491be3e32744bc30440.woff2)
                        format('woff2'),
                    url(https://assets.brevo.com/font/Roboto/Latin/medium/normal/71501f0d8d5aa95960f6475d5487d4c2.woff)
                        format('woff');
            }

            @font-face {
                font-display: fallback;
                font-family: Roboto;
                font-weight: 700;
                src: url(https://assets.brevo.com/font/Roboto/Latin/bold/normal/3ef7cf158f310cf752d5ad08cd0e7e60.woff2)
                        format('woff2'),
                    url(https://assets.brevo.com/font/Roboto/Latin/bold/normal/ece3a1d82f18b60bcce0211725c476aa.woff)
                        format('woff');
            }

            #sib-container input:-ms-input-placeholder {
                text-align: left;
                font-family: 'Helvetica', sans-serif;
                color: #c0ccda;
            }

            #sib-container input::placeholder {
                text-align: left;
                font-family: 'Helvetica', sans-serif;
                color: #c0ccda;
            }

            #sib-container textarea::placeholder {
                text-align: left;
                font-family: 'Helvetica', sans-serif;
                color: #c0ccda;
            }
        </style>
        <link
            rel="stylesheet"
            href="/css/newsletter.css"
        />
    </head>

    <body>
        <header>
            <nav>
    <a href="#" data-target="slide-out" class="sidenav-trigger">
        <i class="material-icons">&#xe5d2;</i>
    </a>
    <div class="nav-wrapper">
        <div class="left react-admin-logo">
            <a href=""> <svg version="1.0" x="0px" y="0px" preserveAspectRatio="xMidYMid meet" viewBox="0 0 130 130" >
<style type="text/css">
	:root{
		--color: #ffffff;
	}
	.st0{opacity:0.3;}
	.st2{opacity:0.6;}
	.st1{fill: var(--color);}
</style>
<g id="layer3Fill" class="st0">
	<polygon class="st1" points="67.4,117.7 81.3,125.7 88.7,112.9 75.7,112.9 	"/>
	<polygon class="st1" points="12.3,67.5 4.4,81.2 17.2,88.6 17.2,76 	"/>
	<polygon class="st1" points="62.6,12.3 48.8,4.3 41.4,17.1 54.2,17.1 	"/>
	<polygon class="st1" points="117.7,62.6 125.7,48.8 112.8,41.3 112.8,54.1 	"/>
</g>
<g id="layer3Border" class="st2">
	<path class="st1" d="M39.2,17.1c0.5,0,1.7,0,2.2,0l7.4-12.8l13.8,8l1.9-1.1L48.1,1.7L39.2,17.1z"/>
	<path class="st1" d="M112.8,39.1c0,0.5,0,1.7,0,2.2l12.9,7.5l-8,13.8c0.3,0.5,0.8,1.5,1.1,2l9.5-16.5L112.8,39.1z"/>
	<path class="st1" d="M88.7,112.9l-7.4,12.8l-13.9-8l-1.9,1.1l16.5,9.5l8.9-15.4C90.4,112.9,89.2,112.9,88.7,112.9z"/>
	<path class="st1" d="M12.3,67.5c-0.3-0.5-0.8-1.4-1.1-1.9L1.8,82l15.4,8.9c0-0.6,0-1.7,0-2.3L4.4,81.2L12.3,67.5z"/>
</g>
<g id="layer2Fill" class="st2">
	<polygon class="st1" points="41.9,112.9 48.9,125.1 70.1,112.9 	"/>
	<polygon class="st1" points="17.2,70.1 17.2,41.9 5,49 	"/>
	<polygon class="st1" points="60.1,17.1 88.1,17.1 81.1,5 	"/>
	<polygon class="st1" points="112.8,60 112.8,88.2 125,81.1 	"/>
</g>
<g id="layer2Border">
	<polygon class="st1" points="17.2,76 17.2,70.1 5,49 17.2,41.9 17.2,38.5 1,47.9 	"/>
	<path class="st1" d="M54.2,17.1h5.9c0,0,19.9-11.5,21-12.1l7,12.1c0.8,0,2.5,0,3.3,0L82.1,1L54.2,17.1z"/>
	<polygon class="st1" points="112.8,54.1 112.8,60 125,81.1 112.8,88.2 112.8,91.5 129,82.2 	"/>
	<path class="st1" d="M48.9,125.1l-7-12.2c-0.8,0-2.6,0-3.4,0l9.3,16.1c6.7-3.9,21.4-12.3,27.9-16.1c-1.4,0-5.6,0-5.6,0L48.9,125.1z
		"/>
</g>
<path id="raBorder" class="st1" d="M17,17v96h96V17H17z M108,108H22V22h86V108z"/>
<g id="ra">
	<path id="aLetter" class="st1" d="M96.1,55.4c-0.7-1.9-2-3.2-3.7-4c-1.9-0.8-4.6-1.2-8.2-1.2c-4.2,0-7.9,0.3-11.1,1v4.2
		c1.2-0.2,2.7-0.4,4.7-0.5c1.9-0.1,3.5-0.2,4.8-0.2c2.9,0,5,0.2,6.2,0.5c1.3,0.4,2.1,1.2,2.5,2.3c0.5,1.2,0.7,3.2,0.7,6.1V66
		c-6.2-0.2-9.9-0.3-11.1-0.3c-2.5,0-4.5,0.3-5.9,1c-1.4,0.7-2.3,1.8-2.9,3.2c-0.6,1.4-0.9,3.5-0.9,6.2c0,3.9,0.9,6.5,2.4,8
		c1.7,1.5,4.2,2.1,7.8,2.1c2.4,0,4.6-0.4,6.4-1.1c1.9-0.7,3.2-2.1,4-4.3h0.3l0.3,4.9h4.7v-22C97.1,60,96.8,57.3,96.1,55.4z M92,71.6
		c0,2.9-0.4,5.4-1.3,7.1c-0.6,1.2-1.6,2-2.7,2.3c-1.3,0.4-2.8,0.6-4.7,0.8c-2,0-3.4-0.2-4.4-0.5c-0.9-0.4-1.6-1-2-1.8
		c-0.4-0.8-0.6-2.1-0.6-3.8s0.2-3,0.5-3.9c0.3-0.9,0.9-1.5,1.7-1.8s2.1-0.5,3.7-0.5H92V71.6z"/>
	<path id="rLetter" class="st1" d="M62.4,61.2c0.9-2.2,1.3-5.1,1.3-8.5c0-3.1-0.3-5.7-0.8-7.6c-0.5-2-1.7-3.5-3.4-4.7
		c-1.8-1.2-4.4-1.8-7.9-1.8H33.5v47.1H39V67h11.9h1.2l6.5,18.8h5.9L57.3,66C59.9,65,61.6,63.4,62.4,61.2z M55.4,61.2
		c-1.3,0.7-3.1,1-5.6,1H39V43.5h11.2c2.4,0,4.2,0.3,5.4,1c1.2,0.7,2,1.6,2.2,2.8c0.3,1.3,0.5,3,0.5,5.5c0,2.3-0.2,4.2-0.6,5.5
		C57.3,59.5,56.6,60.5,55.4,61.2z"/>
</g>
</svg>
 </a>
        </div>
        <div class="left">
            <div id="docsearch" class="center"></div>
        </div>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li class="active">
                <a href="/documentation.html">Documentation</a>
            </li>
            <li>
                <a href="/Demos.html">Demos</a>
            </li>
            <li>
                <a href="https://marmelab.com/en/blog/#react-admin">Blog</a>
            </li>
            <li>
                <a
                    href="https://marmelab.com/ra-enterprise/"
                    style="color: #f0c070"
                    >Enterprise Edition</a
                >
            </li>
            <li>
                <a
                    href="https://github.com/marmelab/react-admin"
                    title="GitHub"
                >
                    <svg
                        viewBox="0 0 256 250"
                        preserveAspectRatio="xMidYMid"
                        style="
                            height: 20px;
                            vertical-align: middle;
                            fill: #ffffff;
                        "
                    >
                        <path
                            d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403z"
                        ></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://discord.gg/GeZF9sqh3N" title="Discord">
                    <svg
                        height="25px"
                        width="25px"
                        viewBox="0 -28.5 256 256"
                        preserveAspectRatio="xMidYMid"
                        style="
                            height: 20px;
                            vertical-align: middle;
                            margin-right: 10px;
                            fill: #ffffff;
                        "
                    >
                        <path
                            d="M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"
                        ></path>
                    </svg>
                </a>
            </li>
        </ul>
    </div>
</nav>

            <ul id="slide-out" class="sidenav sidenav-fixed">
                <li class="logo">
                    <a href=""
                        ><img src="/assets/logo_white.png"
                    /></a>
                </li>
                <li class="version">
<a class="dropdown-trigger" href="#" data-target="versions">
    
    
    
    <svg class="caret" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
        <path d="M7 10l5 5 5-5z"></path>
        <path d="M0 0h24v24H0z" fill="none"></path>
    </svg>
</a>
<ul id="versions" class="dropdown-content">
    
</ul>
</li>
                <a class="center-align switch" style="display:block;margin-bottom: 1em" name="beginner-mode" title="Hide the sections concerning advanced usage to navigate more easily in the documentation">
<label>
  <input type="checkbox" name="beginner-mode-trigger" id="beginner-mode-trigger" />
  <span class="lever"></span>
  Beginner Mode
</label>
</a>

<ul><div>Getting Started</div>
  <li  class="beginner" ><a class="nav-link" href="./Tutorial.html">Tutorial</a></li>
  <li  class="beginner" ><a class="nav-link" href="./Features.html">Features</a></li>
  <li ><a class="nav-link" href="./Architecture.html">Key concepts</a></li>
  <li><a class="nav-link external" href="https://github.com/marmelab/react-admin/releases" target="_blank">What's new?</a></li>
  <li  class="beginner" ><a class="nav-link" href="./CreateReactAdmin.html">Create React Admin</a></li>
  <li  class="beginner" ><a class="nav-link" href="./Vite.html">Vite</a></li>
  <li ><a class="nav-link" href="./NextJs.html">Next.js</a></li>
  <li ><a class="nav-link" href="./Remix.html">Remix</a></li>
  <li ><a class="nav-link" href="./CreateReactApp.html">Create React App</a></li>
  <li  class="beginner" ><a class="nav-link" href="./Community.html">Community</a></li>
  <li ><a class="nav-link" href="./Upgrade.html">Upgrading to v4</a></li>
</ul>

<ul><div>App Configuration</div>
  <li  class="beginner" ><a class="nav-link" href="./Admin.html"><code>&lt;Admin&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./Resource.html"><code>&lt;Resource&gt;</code></a></li>
  <li ><a class="nav-link" href="./CustomRoutes.html"><code>&lt;CustomRoutes&gt;</code></a></li>
</ul>

<ul><div>Data Fetching</div>
  <li  class="active beginner" ><a class="nav-link" href="./DataProviders.html">Introduction</a></li>
  <li  class="beginner" ><a class="nav-link" href="./DataProviderList.html">Supported backends</a></li>
  <li ><a class="nav-link" href="./DataProviderWriting.html">Writing A Data Provider</a></li>
  <li  class="beginner" ><a class="nav-link" href="./Actions.html">Querying the API</a></li>
  <li ><a class="nav-link" href="./DataProviderLive.html">Real-time Updates &amp; Locks<img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useDataProvider.html"><code>useDataProvider</code></a></li>
  <li ><a class="nav-link" href="./useGetList.html"><code>useGetList</code></a></li>
  <li ><a class="nav-link" href="./useInfiniteGetList.html"><code>useInfiniteGetList</code></a></li>
  <li ><a class="nav-link" href="./useGetOne.html"><code>useGetOne</code></a></li>
  <li ><a class="nav-link" href="./useGetMany.html"><code>useGetMany</code></a></li>
  <li ><a class="nav-link" href="./useGetManyReference.html"><code>useGetManyReference</code></a></li>
  <li ><a class="nav-link" href="./useCreate.html"><code>useCreate</code></a></li>
  <li ><a class="nav-link" href="./useUpdate.html"><code>useUpdate</code></a></li>
  <li ><a class="nav-link" href="./useUpdateMany.html"><code>useUpdateMany</code></a></li>
  <li ><a class="nav-link" href="./useDelete.html"><code>useDelete</code></a></li>
  <li ><a class="nav-link" href="./useDeleteMany.html"><code>useDeleteMany</code></a></li>
  <li ><a class="nav-link" href="./useGetTree.html"><code>useGetTree</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./withLifecycleCallbacks.html"><code>withLifecycleCallbacks</code></a></li>
  <li ><a class="nav-link" href="./fetchJson.html"><code>fetchJson</code></a></li>
</ul>

<ul><div>Security</div>
  <li  class="beginner" ><a class="nav-link" href="./Authentication.html">Introduction</a></li>
  <li  class="beginner" ><a class="nav-link" href="./AuthProviderList.html">Supported backends</a></li>
  <li  class="beginner" ><a class="nav-link" href="./AuthProviderWriting.html">Writing An Auth Provider</a></li>
  <li ><a class="nav-link" href="./Permissions.html">Permissions</a></li>
  <li ><a class="nav-link" href="./AuthRBAC.html">RBAC<img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./Authenticated.html"><code>&lt;Authenticated&gt;</code></a></li>
  <li ><a class="nav-link" href="./IfCanAccess.html"><code>&lt;IfCanAccess&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./WithPermissions.html"><code>&lt;WithPermissions&gt;</code></a></li>
  <li ><a class="nav-link" href="./useAuthProvider.html"><code>useAuthProvider</code></a></li>
  <li ><a class="nav-link" href="./useAuthenticated.html"><code>useAuthenticated</code></a></li>
  <li ><a class="nav-link" href="./useAuthState.html"><code>useAuthState</code></a></li>
  <li ><a class="nav-link" href="./useGetIdentity.html"><code>useGetIdentity</code></a></li>
  <li ><a class="nav-link" href="./useLogin.html"><code>useLogin</code></a></li>
  <li ><a class="nav-link" href="./useLogout.html"><code>useLogout</code></a></li>
  <li ><a class="nav-link" href="./usePermissions.html"><code>usePermissions</code></a></li>
  <li ><a class="nav-link" href="./useCanAccess.html"><code>useCanAccess</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./canAccess.html"><code>canAccess</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./addRefreshAuthToAuthProvider.html"><code>addRefreshAuthToAuthProvider</code></a></li>
  <li ><a class="nav-link" href="./addRefreshAuthToDataProvider.html"><code>addRefreshAuthToDataProvider</code></a></li>
</ul>

<ul><div>List Page</div>
  <li  class="beginner" ><a class="nav-link" href="./ListTutorial.html">Introduction</a></li>
  <li  class="beginner" ><a class="nav-link" href="./FilteringTutorial.html">Filtering The List</a></li>
  <li  class="beginner" ><a class="nav-link" href="./List.html"><code>&lt;List&gt;</code></a></li>
  <li ><a class="nav-link" href="./ListBase.html"><code>&lt;ListBase&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./ListGuesser.html"><code>&lt;ListGuesser&gt;</code></a></li>
  <li ><a class="nav-link" href="./InfiniteList.html"><code>&lt;InfiniteList&gt;</code></a></li>
  <li ><a class="nav-link" href="./TreeWithDetails.html"><code>&lt;TreeWithDetails&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li  class="beginner" ><a class="nav-link" href="./Datagrid.html"><code>&lt;Datagrid&gt;</code></a></li>
  <li ><a class="nav-link" href="./DatagridAG.html"><code>&lt;DatagridAG&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li  class="beginner" ><a class="nav-link" href="./SimpleList.html"><code>&lt;SimpleList&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./SingleFieldList.html"><code>&lt;SingleFieldList&gt;</code></a></li>
  <li ><a class="nav-link" href="./EditableDatagrid.html"><code>&lt;EditableDatagrid&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./Calendar.html"><code>&lt;Calendar&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./FilterButton.html"><code>&lt;FilterButton&gt;</code></a></li>
  <li ><a class="nav-link" href="./FilterList.html"><code>&lt;FilterList&gt;</code></a></li>
  <li ><a class="nav-link" href="./FilterLiveSearch.html"><code>&lt;FilterLiveSearch&gt;</code></a></li>
  <li ><a class="nav-link" href="./SavedQueriesList.html"><code>&lt;SavedQueriesList&gt;</code></a></li>
  <li ><a class="nav-link" href="./StackedFilters.html"><code>&lt;StackedFilters&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./Pagination.html"><code>&lt;Pagination&gt;</code></a></li>
  <li ><a class="nav-link" href="./SortButton.html"><code>&lt;SortButton&gt;</code></a></li>
  <li ><a class="nav-link" href="./SelectColumnsButton.html"><code>&lt;SelectColumnsButton&gt;</code></a></li>
  <li ><a class="nav-link" href="./Count.html"><code>&lt;Count&gt;</code></a></li>
  <li ><a class="nav-link" href="./WithListContext.html"><code>&lt;WithListContext&gt;</code></a></li>
  <li ><a class="nav-link" href="./useListContext.html"><code>useListContext</code></a></li>
  <li ><a class="nav-link" href="./useList.html"><code>useList</code></a></li>
  <li ><a class="nav-link" href="./useListController.html"><code>useListController</code></a></li>
  <li ><a class="nav-link" href="./useUnselect.html"><code>useUnselect</code></a></li>
  <li ><a class="nav-link" href="./useUnselectAll.html"><code>useUnselectAll</code></a></li>
</ul>

<ul><div>Creation & Edition Pages</div>
  <li  class="beginner" ><a class="nav-link" href="./EditTutorial.html">Introduction</a></li>
  <li  class="beginner" ><a class="nav-link" href="./Validation.html">Form Validation</a></li>
  <li  class="beginner" ><a class="nav-link" href="./Create.html"><code>&lt;Create&gt;</code></a></li>
  <li ><a class="nav-link" href="./CreateBase.html"><code>&lt;CreateBase&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./Edit.html"><code>&lt;Edit&gt;</code></a></li>
  <li ><a class="nav-link" href="./EditBase.html"><code>&lt;EditBase&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./EditGuesser.html"><code>&lt;EditGuesser&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./SimpleForm.html"><code>&lt;SimpleForm&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./TabbedForm.html"><code>&lt;TabbedForm&gt;</code></a></li>
  <li ><a class="nav-link" href="./Form.html"><code>&lt;Form&gt;</code></a></li>
  <li ><a class="nav-link" href="./LongForm.html"><code>&lt;LongForm&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./AccordionForm.html"><code>&lt;AccordionForm&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./WizardForm.html"><code>&lt;WizardForm&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./EditDialog.html"><code>&lt;EditDialog&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./EditInDialogButton.html"><code>&lt;EditInDialogButton&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./CreateDialog.html"><code>&lt;CreateDialog&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./CreateInDialogButton.html"><code>&lt;CreateInDialogButton&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./JsonSchemaForm.html"><code>&lt;JsonSchemaForm&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./Toolbar.html"><code>&lt;Toolbar&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./SaveButton.html"><code>&lt;SaveButton&gt;</code></a></li>
  <li ><a class="nav-link" href="./AutoSave.html"><code>&lt;AutoSave&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useCreateContext.html"><code>useCreateContext</code></a></li>
  <li ><a class="nav-link" href="./useCreateController.html"><code>useCreateController</code></a></li>
  <li ><a class="nav-link" href="./useEditContext.html"><code>useEditContext</code></a></li>
  <li ><a class="nav-link" href="./useEditController.html"><code>useEditController</code></a></li>
  <li ><a class="nav-link" href="./useSaveContext.html"><code>useSaveContext</code></a></li>
  <li ><a class="nav-link" href="./useRegisterMutationMiddleware.html"><code>useRegisterMutationMiddleware</code></a></li>
  <li ><a class="nav-link" href="./useUnique.html"><code>useUnique</code></a></li>
</ul>

<ul><div>Show Page</div>
  <li  class="beginner" ><a class="nav-link" href="./ShowTutorial.html">Introduction</a></li>
  <li  class="beginner" ><a class="nav-link" href="./Show.html"><code>&lt;Show&gt;</code></a></li>
  <li ><a class="nav-link" href="./ShowBase.html"><code>&lt;ShowBase&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./ShowGuesser.html"><code>&lt;ShowGuesser&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./SimpleShowLayout.html"><code>&lt;SimpleShowLayout&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./TabbedShowLayout.html"><code>&lt;TabbedShowLayout&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./Labeled.html"><code>&lt;Labeled&gt;</code></a></li>
  <li ><a class="nav-link" href="./ShowInDialogButton.html"><code>&lt;ShowInDialogButton&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useShowContext.html"><code>useShowContext</code></a></li>
  <li ><a class="nav-link" href="./useShowController.html"><code>useShowController</code></a></li>
</ul>

<ul><div>Common</div>
  <li  class="beginner" ><a class="nav-link" href="./WithRecord.html"><code>&lt;WithRecord&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./useRecordContext.html"><code>useRecordContext</code></a></li>
  <li ><a class="nav-link" href="./useGetRecordId.html"><code>useGetRecordId</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./useNotify.html"><code>useNotify</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./useRedirect.html"><code>useRedirect</code></a></li>
  <li ><a class="nav-link" href="./useRefresh.html"><code>useRefresh</code></a></li>
</ul>

<ul><div>Fields</div>
  <li  class="beginner" ><a class="nav-link" href="./Fields.html">Introduction</a></li>
  <li ><a class="nav-link" href="./FieldsForRelationships.html">Fields for Relationships</a></li>
  <li  class="beginner" ><a class="nav-link" href="./ArrayField.html"><code>&lt;ArrayField&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./BooleanField.html"><code>&lt;BooleanField&gt;</code></a></li>
  <li ><a class="nav-link" href="./ChipField.html"><code>&lt;ChipField&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./DateField.html"><code>&lt;DateField&gt;</code></a></li>
  <li ><a class="nav-link" href="./EmailField.html"><code>&lt;EmailField&gt;</code></a></li>
  <li ><a class="nav-link" href="./FileField.html"><code>&lt;FileField&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./FunctionField.html"><code>&lt;FunctionField&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./ImageField.html"><code>&lt;ImageField&gt;</code></a></li>
  <li ><a class="nav-link" href="./MarkdownField.html"><code>&lt;MarkdownField&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li  class="beginner" ><a class="nav-link" href="./NumberField.html"><code>&lt;NumberField&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./ReferenceField.html"><code>&lt;ReferenceField&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./ReferenceArrayField.html"><code>&lt;ReferenceArrayField&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./ReferenceManyField.html"><code>&lt;ReferenceManyField&gt;</code></a></li>
  <li ><a class="nav-link" href="./ReferenceManyCount.html"><code>&lt;ReferenceManyCount&gt;</code></a></li>
  <li ><a class="nav-link" href="./ReferenceManyToManyField.html"><code>&lt;ReferenceManyToManyField&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./ReferenceOneField.html"><code>&lt;ReferenceOneField&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./RichTextField.html"><code>&lt;RichTextField&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./SelectField.html"><code>&lt;SelectField&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./TextField.html"><code>&lt;TextField&gt;</code></a></li>
  <li ><a class="nav-link" href="./TranslatableFields.html"><code>&lt;TranslatableFields&gt;</code></a></li>
  <li ><a class="nav-link" href="./UrlField.html"><code>&lt;UrlField&gt;</code></a></li>
  <li ><a class="nav-link" href="./WrapperField.html"><code>&lt;WrapperField&gt;</code></a></li>
</ul>

<ul><div>Inputs</div>
  <li  class="beginner" ><a class="nav-link" href="./Inputs.html">Introduction</a></li>
  <li  class="beginner" ><a class="nav-link" href="./ArrayInput.html"><code>&lt;ArrayInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./AutocompleteInput.html"><code>&lt;AutocompleteInput&gt;</code></a></li>
  <li ><a class="nav-link" href="./AutocompleteArrayInput.html"><code>&lt;AutocompleteArrayInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./BooleanInput.html"><code>&lt;BooleanInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./CheckboxGroupInput.html"><code>&lt;CheckboxGroupInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./DateInput.html"><code>&lt;DateInput></code></a></li>
  <li ><a class="nav-link" href="./DateTimeInput.html"><code>&lt;DateTimeInput&gt;</code></a></li>
  <li ><a class="nav-link" href="./DualListInput.html"><code>&lt;DualListInput&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./FileInput.html"><code>&lt;FileInput&gt;</code></a></li>
  <li ><a class="nav-link" href="./ImageInput.html"><code>&lt;ImageInput&gt;</code></a></li>
  <li ><a class="nav-link" href="./MarkdownInput.html"><code>&lt;MarkdownInput&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./NullableBooleanInput.html"><code>&lt;NullableBooleanInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./NumberInput.html"><code>&lt;NumberInput&gt;</code></a></li>
  <li ><a class="nav-link" href="./PasswordInput.html"><code>&lt;PasswordInput&gt;</code></a></li>
  <li ><a class="nav-link" href="./PredictiveTextInput.html"><code>&lt;PredictiveTextInput&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li  class="beginner" ><a class="nav-link" href="./RadioButtonGroupInput.html"><code>&lt;RadioButtonGroupInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./ReferenceInput.html"><code>&lt;ReferenceInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./ReferenceArrayInput.html"><code>&lt;ReferenceArrayInput&gt;</code></a></li>
  <li ><a class="nav-link" href="./ReferenceManyInput.html"><code>&lt;ReferenceManyInput&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./ReferenceManyToManyInput.html"><code>&lt;ReferenceManyToManyInput&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./ReferenceNodeInput.html"><code>&lt;ReferenceNodeInput&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./ReferenceOneInput.html"><code>&lt;ReferenceOneInput&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li  class="beginner" ><a class="nav-link" href="./RichTextInput.html"><code>&lt;RichTextInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./SearchInput.html"><code>&lt;SearchInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./SelectInput.html"><code>&lt;SelectInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./SelectArrayInput.html"><code>&lt;SelectArrayInput&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./SimpleFormIterator.html"><code>&lt;SimpleFormIterator&gt;</code></a></li>
  <li ><a class="nav-link" href="./SmartRichTextInput.html"><code>&lt;SmartRichTextInput&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li  class="beginner" ><a class="nav-link" href="./TextInput.html"><code>&lt;TextInput&gt;</code></a></li>
  <li ><a class="nav-link" href="./TimeInput.html"><code>&lt;TimeInput&gt;</code></a></li>
  <li ><a class="nav-link" href="./TranslatableInputs.html"><code>&lt;TranslatableInputs&gt;</code></a></li>
  <li ><a class="nav-link" href="./TreeInput.html"><code>&lt;TreeInput&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useInput.html"><code>useInput</code></a></li>
</ul>

<ul><div>Preferences</div>
  <li ><a class="nav-link" href="./Store.html">Introduction</a></li>
  <li ><a class="nav-link" href="./useStore.html"><code>useStore</code></a></li>
  <li ><a class="nav-link" href="./useRemoveFromStore.html"><code>useRemoveFromStore</code></a></li>
  <li ><a class="nav-link" href="./useResetStore.html"><code>useResetStore</code></a></li>
  <li ><a class="nav-link" href="./useStoreContext.html"><code>useStoreContext</code></a></li>
  <li ><a class="nav-link" href="./Configurable.html"><code>&lt;Configurable&gt;</code></a></li>
</ul>

<ul><div>I18N Provider and Translations</div>
  <li ><a class="nav-link" href="./Translation.html">Introduction</a></li>
  <li ><a class="nav-link" href="./TranslationSetup.html">Setting Up</a></li>
  <li ><a class="nav-link" href="./TranslationLocales.html">Supported Locales</a></li>
  <li ><a class="nav-link" href="./TranslationTranslating.html">Translating UI Components</a></li>
  <li ><a class="nav-link" href="./TranslationWriting.html">Writing an i18nProvider</a></li>
  <li ><a class="nav-link" href="./useTranslate.html"><code>useTranslate</code></a></li>
  <li ><a class="nav-link" href="./useLocaleState.html"><code>useLocaleState</code></a></li>
  <li ><a class="nav-link" href="./LocalesMenuButton.html"><code>&lt;LocalesMenuButton&gt;</code></a></li>
</ul>

<ul><div>Other UI components</div>
  <li  class="beginner" ><a class="nav-link" href="./Layout.html"><code>&lt;Layout&gt;</code></a></li>
  <li ><a class="nav-link" href="./ContainerLayout.html"><code>&lt;ContainerLayout&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./SolarLayout.html"><code>&lt;SolarLayout&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li  class="beginner" ><a class="nav-link" href="./AppBar.html"><code>&lt;AppBar&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./Menu.html"><code>&lt;Menu&gt;</code></a></li>
  <li ><a class="nav-link" href="./MultiLevelMenu.html"><code>&lt;MultiLevelMenu&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./IconMenu.html"><code>&lt;IconMenu&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./Title.html"><code>&lt;Title&gt;</code></a></li>
  <li ><a class="nav-link" href="./Breadcrumb.html"><code>&lt;Breadcrumb&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./Search.html"><code>&lt;Search&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./SearchWithResult.html"><code>&lt;SearchWithResult&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./Confirm.html"><code>&lt;Confirm&gt;</code></a></li>
  <li  class="beginner" ><a class="nav-link" href="./Buttons.html">Buttons</a></li>
  <li ><a class="nav-link" href="./RevisionsButton.html"><code>&lt;RevisionsButton&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./CheckForApplicationUpdate.html"><code>&lt;CheckForApplicationUpdate&gt;</code></a></li>
  <li ><a class="nav-link" href="./UpdateButton.html"><code>&lt;UpdateButton&gt;</code></a></li>
  <li ><a class="nav-link" href="./RecordRepresentation.html"><code>&lt;RecordRepresentation&gt;</code></a></li>
  <li ><a class="nav-link" href="./PrevNextButtons.html"><code>&lt;PrevNextButtons&gt;</code></a></li>
  <li ><a class="nav-link" href="./useDefineAppLocation.html"><code>useDefineAppLocation</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useGetRecordRepresentation.html"><code>useGetRecordRepresentation</code></a></li>
</ul>

<ul><div>Theming</div>
  <li  class="beginner" ><a class="nav-link" href="./Theming.html">Introduction</a></li>
  <li  class="beginner" ><a class="nav-link" href="./SX.html">The <code>sx</code> prop</a></li>
  <li  class="beginner" ><a class="nav-link" href="./AppTheme.html">Application Theme</a></li>
  <li ><a class="nav-link" href="./BoxStackGrid.html"><code>&lt;Box&gt;</code>, <code>&lt;Stack&gt;</code> and <code>&lt;Grid&gt;</code></a></li>
  <li ><a class="nav-link" href="./ToggleThemeButton.html"><code>&lt;ToggleThemeButton&gt;</code></a></li>
  <li ><a class="nav-link" href="./useMediaQuery.html"><code>useMediaQuery</code></a></li>
  <li ><a class="nav-link" href="./useTheme.html"><code>useTheme</code></a></li>
</ul>

<ul><div>Realtime</div>
  <li ><a class="nav-link" href="./Realtime.html">Introduction</a></li>
  <li ><a class="nav-link" href="./RealtimeDataProvider.html">Data Provider Requirements</a></li>
  <li ><a class="nav-link" href="./usePublish.html"><code>usePublish</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useSubscribe.html"><code>useSubscribe</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useSubscribeCallback.html"><code>useSubscribeCallback</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useSubscribeToRecord.html"><code>useSubscribeToRecord</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useSubscribeToRecordList.html"><code>useSubscribeToRecordList</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useLock.html"><code>useLock</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useUnlock.html"><code>useUnlock</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useGetLock.html"><code>useGetLock</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useGetLockLive.html"><code>useGetLockLive</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useGetLocks.html"><code>useGetLocks</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useGetLocksLive.html"><code>useGetLocksLive</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useLockOnMount.html"><code>useLockOnMount</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useLockOnCall.html"><code>useLockOnCall</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useGetListLive.html"><code>useGetListLive</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./useGetOneLive.html"><code>useGetOneLive</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./ListLive.html"><code>&lt;ListLive&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./EditLive.html"><code>&lt;EditLive&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./ShowLive.html"><code>&lt;ShowLive&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
  <li ><a class="nav-link" href="./MenuLive.html"><code>&lt;MenuLive&gt;</code><img class="premium" src="./img/premium.svg" /></a></li>
</ul>

<ul><div>Recipes</div>
  <li ><a class="nav-link" href="./Caching.html">Caching</a></li>
  <li ><a class="nav-link" href="./Routing.html">Routing</a></li>
  <li ><a class="nav-link" href="./UnitTesting.html">Unit Testing</a></li>
  <li ><a class="nav-link" href="./AdvancedTutorials.html">Advanced tutorials</a></li>
</ul>

<li ><a class="nav-link" href="./Ecosystem.html">Ecosystem</a></li>
<li ><a class="nav-link" href="./FAQ.html">FAQ</a></li>
<li  class="beginner" ><a class="nav-link" href="./Reference.html">Index</a></li>

<div class="beginner-mode-on" style="margin:1em;padding:1em;background:#ffffca;border-radius:4px;display:none;font-size:0.8em;opacity:0.8;text-align:center;">
  <a href="#beginner-mode">Beginner mode is on</a>. Turn it off to reveal more documentation for advanced components.
</div>

            </ul>
        </header>

        <main>
            <div class="container sticker-container">
                <div class="row">
                    <div class="col s12 m9">
                        <div
                            class="markdown-section DocSearch-content toc-content"
                        >
                            <h1 id="データフェッチング">データフェッチング</h1>

<p>React-adminアプリは、使用するAPIがREST、GraphQL、RPC、さらにはSOAPであっても、その方言に関係なく構築できます。これは、react-adminが<code class="language-plaintext highlighter-rouge">fetch</code>を直接使用しないためです。代わりに、APIとインターフェースするためのデータプロバイダーオブジェクトと、データフェッチングを処理するための<a href="https://tanstack.com/query/v3/docs/react/overview">react-query</a>を使用します。</p>

<h2 id="データプロバイダー">データプロバイダー</h2>

<p>react-adminがAPIと通信する必要があるときは、<code class="language-plaintext highlighter-rouge">dataProvider</code>と呼ばれるオブジェクトを介して行います。この<code class="language-plaintext highlighter-rouge">dataProvider</code>は、react-adminが標準化された方法でAPIをクエリできるようにする定義済みインターフェースを公開します。</p>

<p><img src="./img/data-provider.png" class="no-shadow" alt="バックエンドに依存しない" /></p>

<p>例えば、APIから単一のレコードを取得するために、react-adminは<code class="language-plaintext highlighter-rouge">dataProvider.getOne()</code>を呼び出します：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">dataProvider</span>
        <span class="p">.</span><span class="nx">getOne</span><span class="p">(</span><span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">123</span> <span class="p">})</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span> <span class="c1">// { id: 123, title: "hello, world" }</span>
        <span class="p">});</span>
</code></pre></div></div>

<p>データプロバイダーの役割は、これらのメソッド呼び出しをHTTPリクエストに変換し、HTTPレスポンスをreact-adminが期待するデータ形式に変換することです。技術的には、データプロバイダーはAPIの<em>アダプター</em>です。</p>

<p>このアダプターシステムのおかげで、react-adminはどのAPIとも通信できます。オープンソースパッケージのリストについては、<a href="./DataProviderList.md">サポートされているバックエンドのリスト</a>を参照して、APIに適したものを選んでください。</p>

<p>特定のバックエンドに対応するために、<a href="./DataProviderWriting.md">独自のデータプロバイダーを作成</a>することもできます。データプロバイダーは、<code class="language-plaintext highlighter-rouge">fetch</code>、<code class="language-plaintext highlighter-rouge">axios</code>、<code class="language-plaintext highlighter-rouge">apollo-client</code>、その他のライブラリを使用してAPIと通信できます。また、データプロバイダーはカスタムHTTPヘッダー、認証などを追加する理想的な場所でもあります。</p>

<p>データプロバイダーは、以下のメソッドを持つ必要があります：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">getList</span><span class="p">:</span>    <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">,</span> <span class="c1">// ソート、フィルター、ページネーションに基づいてレコードのリストを取得</span>
    <span class="na">getOne</span><span class="p">:</span>     <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">,</span> <span class="c1">// IDで単一のレコードを取得</span>
    <span class="na">getMany</span><span class="p">:</span>    <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">,</span> <span class="c1">// IDの配列に基づいてレコードのリストを取得</span>
    <span class="na">getManyReference</span><span class="p">:</span> <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">,</span> <span class="c1">// 他のレコードに参照されているレコードを取得（例：投稿に対するコメント）</span>
    <span class="na">create</span><span class="p">:</span>     <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">,</span> <span class="c1">// レコードを作成</span>
    <span class="na">update</span><span class="p">:</span>     <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">,</span> <span class="c1">// パッチに基づいてレコードを更新</span>
    <span class="na">updateMany</span><span class="p">:</span> <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">,</span> <span class="c1">// IDの配列と共通のパッチに基づいてレコードのリストを更新</span>
    <span class="na">delete</span><span class="p">:</span>     <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">,</span> <span class="c1">// IDでレコードを削除</span>
    <span class="na">deleteMany</span><span class="p">:</span> <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="p">,</span> <span class="c1">// IDの配列に基づいてレコードのリストを削除</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>ヒント</strong>: データプロバイダーは、上記の9つのメソッド以外に<a href="#adding-custom-methods">カスタムメソッドを追加</a>することもできます。例えば、非REST APIエンドポイントを呼び出すカスタムメソッドや、ツリー構造の操作、リアルタイム更新の購読などのためのデータプロバイダーを作成できます。</p>

<p>データプロバイダーはreact-adminのアーキテクチャの中心にあります。データプロバイダーインターフェースについて非常に意見が分かれるため、react-adminは非常に柔軟で高度な機能を提供できます。これには、参照の取り扱い、楽観的更新、自動ナビゲーションが含まれます。</p>

<h2 id="admin-dataprovider"><code class="language-plaintext highlighter-rouge">&lt;Admin dataProvider&gt;</code></h2>

<p>データプロバイダーを使用する最初のステップは、<a href="./Admin.md"><code class="language-plaintext highlighter-rouge">&lt;Admin&gt;</code>コンポーネント</a>にデータプロバイダーを渡すことです。<code class="language-plaintext highlighter-rouge">dataProvider</code>プロップを使用して渡すことができます。</p>

<p><a href="./DataProviderList.md">サポートされているAPIバックエンドのリスト</a>からデータプロバイダーを選ぶか、<a href="./DataProviderWriting.md">独自に作成</a>することができます。</p>

<p>例として、<a href="https://github.com/marmelab/react-admin/tree/master/packages/ra-data-simple-rest">Simple RESTデータプロバイダー</a>に焦点を当てます。これは、フィルターとソートのためにシンプルなGETパラメーターを使用するREST APIに適しています。</p>

<p>このプロバイダーを使用するには、<code class="language-plaintext highlighter-rouge">ra-data-simple-rest</code>パッケージをインストールします。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add ra-data-simple-rest
</code></pre></div></div>

<p>次に、RESTバックエンドURLでプロバイダーを初期化し、その結果を<code class="language-plaintext highlighter-rouge">&lt;Admin&gt;</code>コンポーネントの<code class="language-plaintext highlighter-rouge">dataProvider</code>プロップに渡します：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/App.js</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Admin</span><span class="p">,</span> <span class="nx">Resource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">simpleRestProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-simple-rest</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">PostList</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./posts</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">simpleRestProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://path.to.my.api/</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Admin</span> <span class="na">dataProvider</span><span class="p">=</span><span class="si">{</span><span class="nx">dataProvider</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Resource</span> <span class="na">name</span><span class="p">=</span><span class="s">"posts"</span> <span class="na">list</span><span class="p">=</span><span class="si">{</span><span class="nx">PostList</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nc">Admin</span><span class="p">&gt;</span>
<span class="p">);</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</code></pre></div></div>

<p>これだけで、すべてのreact-adminコンポーネントが動作します。</p>

<p>この特定のデータプロバイダーがreact-adminの呼び出しをAPI呼び出しにマッピングする方法は次の通りです：</p>

<table>
  <thead>
    <tr>
      <th>メソッド名</th>
      <th>API呼び出し</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">getList</code></td>
      <td><code class="language-plaintext highlighter-rouge">GET http://my.api.url/posts?sort=["title","ASC"]&amp;range=[0, 24]&amp;filter={"title":"bar"}</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">getOne</code></td>
      <td><code class="language-plaintext highlighter-rouge">GET http://my.api.url/posts/123</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">getMany</code></td>
      <td><code class="language-plaintext highlighter-rouge">GET http://my.api.url/posts?filter={"ids":[123,456,789]}</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">getManyReference</code></td>
      <td><code class="language-plaintext highlighter-rouge">GET http://my.api.url/posts?filter={"author_id":345}</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">create</code></td>
      <td><code class="language-plaintext highlighter-rouge">POST http://my.api.url/posts</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">update</code></td>
      <td><code class="language-plaintext highlighter-rouge">PUT http://my.api.url/posts/123</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">updateMany</code></td>
      <td><code class="language-plaintext highlighter-rouge">PUT http://my.api.url/posts/123</code>の複数回呼び出し</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">delete</code></td>
      <td><code class="language-plaintext highlighter-rouge">DELETE http://my.api.url/posts/123</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">deleteMany</code></td>
      <td><code class="language-plaintext highlighter-rouge">DELETE http://my.api.url/posts/123</code>の複数回呼び出し</td>
    </tr>
  </tbody>
</table>

<p><strong>注意</strong>: Simple RESTクライアントは、<code class="language-plaintext highlighter-rouge">getList</code>呼び出しに対するレスポンスに<code class="language-plaintext highlighter-rouge">Content-Range</code>ヘッダーを含めることをAPIに期待します。この値はコレクション内のリソースの総数でなければなりません。これにより、react-adminはリソースの総ページ数を知り、ページネーションコントロールを構築できます。</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">Content-Range</span><span class="o">:</span> <span class="nt">posts</span> <span class="err">0</span><span class="nt">-24</span><span class="o">/</span><span class="err">319</span>
</code></pre></div></div>

<p>APIがJSコードとは別のドメインにある場合、このヘッダーを<code class="language-plaintext highlighter-rouge">Access-Control-Expose-Headers</code>という<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">CORS</a>ヘッダーでホワイトリストに登録する必要があります。</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Access</span><span class="o">-</span><span class="nb">Control</span><span class="o">-</span><span class="nv">Expose</span><span class="o">-</span><span class="nv">Headers</span><span class="o">:</span><span class="w"> </span><span class="nv">Content</span><span class="o">-</span><span class="nb">Range</span><span class="w">
</span></code></pre></div></div>

<h2 id="クエリログの有効化">クエリログの有効化</h2>

<p>react-adminは<code class="language-plaintext highlighter-rouge">react-query</code>を使用してデータプロバイダーを呼び出します。ブラウザでreact-queryによって行われたすべての呼び出しを<a href="https://react-query-v3.tanstack.com/devtools">react-query devtools</a>で確認できます。</p>

<p><img src="./img/react-query-devtools.png" alt="React-Query DevTools" /></p>

<p>これらのデブツールを有効にするには、カスタムレイアウトに<code class="language-plaintext highlighter-rouge">&lt;ReactQueryDevtools&gt;</code>コンポーネントを追加します：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Layout</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ReactQueryDevtools</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-query/devtools</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">MyLayout</span> <span class="o">=</span> <span class="nx">props</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="p">&lt;&gt;</span>
        <span class="p">&lt;</span><span class="nc">Layout</span> <span class="si">{</span><span class="p">...</span><span class="nx">props</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">ReactQueryDevtools</span> <span class="na">initialIsOpen</span><span class="p">=</span><span class="si">{</span><span class="kc">false</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/&gt;</span>
<span class="p">);</span>
</code></pre></div></div>

<p>次に、このレイアウトを<code class="language-plaintext highlighter-rouge">&lt;Admin&gt;</code>で使用します：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Admin</span><span class="p">,</span> <span class="nx">Resource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">dataProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./dataProvider</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MyLayout</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./MyLayout</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Admin</span> <span class="na">dataProvider</span><span class="p">=</span><span class="si">{</span><span class="nx">dataProvider</span><span class="si">}</span> <span class="na">layout</span><span class="p">=</span><span class="si">{</span><span class="nx">MyLayout</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Resource</span> <span class="na">name</span><span class="p">=</span><span class="s">"posts"</span> <span class="na">list</span><span class="p">=</span><span class="si">{</span><span class="nx">PostList</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nc">Admin</span><span class="p">&gt;</span>
<span class="p">);</span>
</code></pre></div></div>

<p><strong>ヒント</strong>: デフォルトでは、React Query Devtoolsは<code class="language-plaintext highlighter-rouge">process.env.NODE_ENV === 'development'</code>の場合にのみバンドルに含まれるため、プロダクションビルド時に除外する心配はありません。</p>

<p><strong>ヒント</strong>: 一部のデータプロバイダーには独自のロギングシステムがあります。詳細については、それらのドキュメントを参照してください。例えば、<a href="https://github.com/marmelab/react-admin/tree/master/packages/ra-data-fakerest"><code class="language-plaintext highlighter-rouge">ra-data-fakerest</code>パッケージ</a>は、第二引数に<code class="language-plaintext highlighter-rouge">true</code>を渡すと、REST APIへのすべての呼び出しをブラウザコンソールにログします：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/App.js</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Admin</span><span class="p">,</span> <span class="nx">Resource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">fakeDataProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-fakerest</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">fakeDataProvider</span><span class="p">({</span> <span class="cm">/* データをここに */</span> <span class="p">},</span> <span class="kc">true</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Admin</span> <span class="na">dataProvider</span><span class="p">=</span><span class="si">{</span><span class="nx">dataProvider</span><span class="si">}</span><span class="p">&gt;</span>
        // ...
    <span class="p">&lt;/</span><span class="nc">Admin</span><span class="p">&gt;</span>
<span class="p">);</span>
</code></pre></div></div>

<h2 id="認証の処理">認証の処理</h2>

<p>react-adminでは、データのフェッチを担当するのは<code class="language-plaintext highlighter-rouge">dataProvider</code>であり、認証の管理を担当するのは<a href="./Authentication.md"><code class="language-plaintext highlighter-rouge">authProvider</code></a>です。APIリクエストを認証するために、<code class="language-plaintext highlighter-rouge">dataProvider</code>が行うクエリに<code class="language-plaintext highlighter-rouge">authProvider</code>の情報を使用する必要があります。この目的のために<code class="language-plaintext highlighter-rouge">localStorage</code>を使用できます。</p>

<p>例えば、ログインプロセス中に返されたトークンを使用して、Bearerトークンを介してAPIへのすべてのリクエストを認証する方法を示します。Simple RESTデータプロバイダーを使用します：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// authProvider.js</span>
<span class="kd">const</span> <span class="nx">authProvider</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">login</span><span class="p">:</span> <span class="p">({</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="p">})</span> <span class="o">=&gt;</span>  <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://mydomain.com/authenticate</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="p">}),</span>
            <span class="na">headers</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">({</span> <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span> <span class="p">}),</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="o">||</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(({</span> <span class="nx">token</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="c1">// トークンをローカルストレージに保存</span>
                <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">token</span><span class="dl">'</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="k">catch</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">ネットワークエラー</span><span class="dl">'</span><span class="p">)</span>
            <span class="p">});</span>
    <span class="p">},</span>
    <span class="c1">// ...</span>
<span class="p">};</span>

<span class="c1">// dataProvider.js</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">fetchUtils</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">simpleRestProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-simple-rest</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">fetchJson</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">authenticated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="c1">// ローカルストレージからトークンを使用</span>
        <span class="na">token</span><span class="p">:</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">token</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">fetchUtils</span><span class="p">.</span><span class="nx">fetchJson</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">};</span>
<span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">simpleRestProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://path.to.my.api/</span><span class="dl">'</span><span class="p">,</span> <span class="nx">fetchJson</span><span class="p">);</span>
</code></pre></div></div>

<p>これで、REST APIへのすべてのリクエストに<code class="language-plaintext highlighter-rouge">Authorization: SRTRDFVESGNJYTUKTYTHRG</code>ヘッダーが含まれます。</p>

<p>この例では、<code class="language-plaintext highlighter-rouge">simpleRestProvider</code>は認証を設定するために第二引数を受け入れます。各データプロバイダーには資格情報を受け入れる独自の方法があります。詳細については、使用するデータプロバイダーのドキュメントを参照してください。</p>

<h2 id="カスタムヘッダーの追加">カスタムヘッダーの追加</h2>

<p>データプロバイダーはHTTPを「話しません」ので、HTTPヘッダーの概念はありません。APIにカスタムヘッダーを渡す必要がある場合、使用するデータプロバイダーによって構文が異なります。</p>

<p>例えば、<code class="language-plaintext highlighter-rouge">simpleRestProvider</code>関数は第二引数としてHTTPクライアント関数を受け入れます。デフォルトでは、react-adminの<a href="./fetchJson.md"><code class="language-plaintext highlighter-rouge">fetchUtils.fetchJson()</code></a>関数をHTTPクライアントとして使用します。これはHTML5の<code class="language-plaintext highlighter-rouge">fetch()</code>に似ていますが、JSONデコードとHTTPエラ ーコードを自動的に処理します。</p>

<p>カスタムヘッダーをリクエストに追加する必要がある場合、<code class="language-plaintext highlighter-rouge">fetchJson()</code>呼び出しを独自の関数内で<em>ラップ</em>するだけです：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">fetchUtils</span><span class="p">,</span> <span class="nx">Admin</span><span class="p">,</span> <span class="nx">Resource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">simpleRestProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-simple-rest</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">fetchJson</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">({</span> <span class="na">Accept</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span> <span class="p">});</span>
    <span class="p">}</span>
    <span class="c1">// ここに独自のヘッダーを追加</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">X-Custom-Header</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">foobar</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">fetchUtils</span><span class="p">.</span><span class="nx">fetchJson</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">simpleRestProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://path.to.my.api/</span><span class="dl">'</span><span class="p">,</span> <span class="nx">fetchJson</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Admin</span> <span class="na">dataProvider</span><span class="p">=</span><span class="si">{</span><span class="nx">dataProvider</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Resource</span> <span class="na">name</span><span class="p">=</span><span class="s">"posts"</span> <span class="na">list</span><span class="p">=</span><span class="si">{</span><span class="nx">PostList</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nc">Admin</span><span class="p">&gt;</span>
<span class="p">);</span>
</code></pre></div></div>

<p><strong>ヒント</strong>: TypeScriptユーザー向けに、<code class="language-plaintext highlighter-rouge">fetchJson</code>関数の型付きバージョンを以下に示します：</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fetchJson</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">options</span><span class="p">:</span> <span class="nx">fetchUtils</span><span class="p">.</span><span class="nx">Options</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">customHeaders</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span> <span class="o">||</span>
        <span class="k">new</span> <span class="nx">Headers</span><span class="p">({</span>
            <span class="na">Accept</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">}))</span> <span class="k">as</span> <span class="nx">Headers</span><span class="p">;</span>
    <span class="c1">// ここに独自のヘッダーを追加</span>
    <span class="nx">customHeaders</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">X-Custom-Header</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">foobar</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="nx">customHeaders</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">fetchUtils</span><span class="p">.</span><span class="nx">fetchJson</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>これで、REST APIへのすべてのリクエストに<code class="language-plaintext highlighter-rouge">X-Custom-Header: foobar</code>ヘッダーが含まれます。</p>

<p><strong>警告</strong>: APIがJSコードとは別のドメインにある場合、このヘッダーを<code class="language-plaintext highlighter-rouge">Access-Control-Expose-Headers</code>という<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">CORS</a>ヘッダーでホワイトリストに登録する必要があります。</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Access</span><span class="o">-</span><span class="nb">Control</span><span class="o">-</span><span class="nv">Expose</span><span class="o">-</span><span class="nv">Headers</span><span class="o">:</span><span class="w"> </span><span class="nv">X</span><span class="o">-</span><span class="nv">Custom</span><span class="o">-</span><span class="nv">Header</span><span class="w">
</span></code></pre></div></div>

<p>これはサーバー側で行う必要があります。</p>

<h2 id="ライフサイクルコールバックの追加">ライフサイクルコールバックの追加</h2>

<p>データプロバイダーの呼び出しの前後に特定のデータロジックを実行する必要がある場合があります。例えば、投稿自体を削除する前に関連するコメントを削除したい場合などです。一般的なアドバイスは、このコードを<strong>サーバー側に置く</strong>ことです。もしできない場合、次に最適な場所はデータプロバイダーです。</p>

<p>データプロバイダーメソッドに<code class="language-plaintext highlighter-rouge">if</code>ステートメントを使用して、特定のリソースにのみロジックを実行することはもちろん可能です。以下のように：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="na">delete</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 投稿に関連するすべてのコメントを削除</span>
            <span class="c1">// まず、コメントを取得</span>
            <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">comments</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">httpClient</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">apiUrl</span><span class="p">}</span><span class="s2">/comments?post_id=</span><span class="p">${</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
            <span class="c1">// 次に、それらを削除</span>
            <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">comments</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">comment</span> <span class="o">=&gt;</span> <span class="nx">httpClient</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">apiUrl</span><span class="p">}</span><span class="s2">/comments/</span><span class="p">${</span><span class="nx">comment</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">DELETE</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">})));</span>
        <span class="p">}</span>
        <span class="c1">// デフォルトの実装にフォールバック</span>
        <span class="kd">const</span> <span class="p">{</span> <span class="nx">data</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">httpClient</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">apiUrl</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">resource</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">DELETE</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="p">{</span> <span class="nx">data</span> <span class="p">};</span>
    <span class="p">},</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>しかし、データプロバイダーコードはすぐに読みづらく、保守が難しくなります。react-adminは、データプロバイダーにライフサイクルコールバックを追加するのを容易にするために<code class="language-plaintext highlighter-rouge">withLifecycleCallbacks</code>というヘルパー関数を提供しています：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">withLifecycleCallbacks</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">withLifecycleCallbacks</span><span class="p">(</span><span class="nx">baseDataProvider</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="na">resource</span><span class="p">:</span> <span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">beforeDelete</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">dataProvider</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="c1">// 投稿に関連するすべてのコメントを削除</span>
            <span class="c1">// まず、コメントを取得</span>
            <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">comments</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">dataProvider</span><span class="p">.</span><span class="nx">getList</span><span class="p">(</span><span class="dl">'</span><span class="s1">comments</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">filter</span><span class="p">:</span> <span class="p">{</span> <span class="na">post_id</span><span class="p">:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">},</span>
                <span class="na">pagination</span><span class="p">:</span> <span class="p">{</span> <span class="na">page</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">perPage</span><span class="p">:</span> <span class="mi">1000</span> <span class="p">},</span>
                <span class="na">sort</span><span class="p">:</span> <span class="p">{</span> <span class="na">field</span><span class="p">:</span> <span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="na">order</span><span class="p">:</span> <span class="dl">'</span><span class="s1">DESC</span><span class="dl">'</span> <span class="p">},</span>
            <span class="p">});</span>
            <span class="c1">// 次に、それらを削除</span>
            <span class="k">await</span> <span class="nx">dataProvider</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">(</span><span class="dl">'</span><span class="s1">comments</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">ids</span><span class="p">:</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">comment</span> <span class="o">=&gt;</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">});</span>

            <span class="k">return</span> <span class="nx">params</span><span class="p">;</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]);</span>
</code></pre></div></div>

<p>詳細については、<a href="./withLifecycleCallbacks.md">withLifecycleCallbacks</a>のドキュメントを参照してください。</p>

<h2 id="カスタムメソッドの追加">カスタムメソッドの追加</h2>

<p>APIバックエンドは、非CRUDエンドポイントを公開している場合があります。例えば、RPCエンドポイントを呼び出すためのものです。</p>

<p>例えば、APIがユーザーを<code class="language-plaintext highlighter-rouge">id</code>に基づいて禁止するエンドポイントを公開しているとします：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /api/user/123/ban
</code></pre></div></div>

<p>これらのエンドポイントをアプリコンポーネントに公開するreact-adminの方法は、<code class="language-plaintext highlighter-rouge">dataProvider</code>にカスタムメソッドを追加することです：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">simpleRestDataProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-simple-rest</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">baseDataProvider</span> <span class="o">=</span> <span class="nx">simpleRestDataProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://path.to.my.api/</span><span class="dl">'</span><span class="p">);</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">baseDataProvider</span><span class="p">,</span>
    <span class="na">banUser</span><span class="p">:</span> <span class="p">(</span><span class="nx">userId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">`/api/user/</span><span class="p">${</span><span class="nx">userId</span><span class="p">}</span><span class="s2">/ban`</span><span class="p">,</span> <span class="p">{</span> <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span> <span class="p">})</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div></div>

<p>次に、react-queryの<code class="language-plaintext highlighter-rouge">useMutation</code>フックを使用して<code class="language-plaintext highlighter-rouge">dataProvider.banUser()</code>メソッドを呼び出します：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">useDataProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useMutation</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-query</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">BanUserButton</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">userId</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">useDataProvider</span><span class="p">();</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">mutate</span><span class="p">,</span> <span class="nx">isLoading</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useMutation</span><span class="p">(</span>
        <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">dataProvider</span><span class="p">.</span><span class="nx">banUser</span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span>
    <span class="p">);</span>
    <span class="k">return</span> <span class="p">&lt;</span><span class="nc">Button</span> <span class="na">label</span><span class="p">=</span><span class="s">"Ban"</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">mutate</span><span class="p">()</span><span class="si">}</span> <span class="na">disabled</span><span class="p">=</span><span class="si">{</span><span class="nx">isLoading</span><span class="si">}</span> <span class="p">/&gt;;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>詳細については、<a href="./Actions.md#calling-custom-methods">カスタムメソッドの呼び出し</a>のドキュメントを参照してください。</p>

<h2 id="非同期初期化">非同期初期化</h2>

<p>一部のデータプロバイダーは、非同期初期化フェーズを必要とします（例えば、APIに接続するため）。そのようなデータプロバイダーを使用するには、Reactの<code class="language-plaintext highlighter-rouge">useState</code>と<code class="language-plaintext highlighter-rouge">useEffect</code>を活用してreact-adminリソースをレンダリングする前にそれらを初期化します。</p>

<p>例えば、<code class="language-plaintext highlighter-rouge">ra-data-hasura</code>データプロバイダーは初期化が必要です：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">buildHasuraProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-hasura</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Admin</span><span class="p">,</span> <span class="nx">Resource</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">PostCreate</span><span class="p">,</span> <span class="nx">PostEdit</span><span class="p">,</span> <span class="nx">PostList</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./posts</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 空のデータプロバイダーで開始</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">dataProvider</span><span class="p">,</span> <span class="nx">setDataProvider</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

    <span class="c1">// マウント時に初期化</span>
    <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">buildHasuraProvider</span><span class="p">({</span>
            <span class="na">clientOptions</span><span class="p">:</span> <span class="p">{</span> <span class="na">uri</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:8080/v1/graphql</span><span class="dl">'</span> <span class="p">}</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">setDataProvider</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">dataProvider</span><span class="p">));</span>
    <span class="p">},</span> <span class="p">[]);</span>

    <span class="c1">// データプロバイダーが準備完了するまで管理コンポーネントを非表示にする</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dataProvider</span><span class="p">)</span> <span class="k">return</span> <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Loading...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;;</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">Admin</span> <span class="na">dataProvider</span><span class="p">=</span><span class="si">{</span><span class="nx">dataProvider</span><span class="si">}</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">Resource</span> <span class="na">name</span><span class="p">=</span><span class="s">"Post"</span> <span class="na">list</span><span class="p">=</span><span class="si">{</span><span class="nx">PostList</span><span class="si">}</span> <span class="na">edit</span><span class="p">=</span><span class="si">{</span><span class="nx">PostEdit</span><span class="si">}</span> <span class="na">create</span><span class="p">=</span><span class="si">{</span><span class="nx">PostCreate</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nc">Admin</span><span class="p">&gt;</span>
    <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>ヒント</strong>: この例では、<code class="language-plaintext highlighter-rouge">setState</code>の関数バージョン（<code class="language-plaintext highlighter-rouge">setDataProvider(() =&gt; dataProvider))</code>）を使用しています。これは、一部のレガシーデータプロバイダーが実際には関数であり、<code class="language-plaintext highlighter-rouge">setState</code>がマウント時にすぐにそれらを呼び出すためです。</p>

<h2 id="データプロバイダーの組み合わせ">データプロバイダーの組み合わせ</h2>

<p>複数のAPIに依存するアプリを構築する必要がある場合、<code class="language-plaintext highlighter-rouge">&lt;Admin&gt;</code>コンポーネントは1つの<code class="language-plaintext highlighter-rouge">dataProvider</code>プロップしか受け入れないため、問題に直面することがあります。<code class="language-plaintext highlighter-rouge">combineDataProviders</code>ヘルパーを使用して、複数のデータプロバイダーを1つに組み合わせることができます。このヘルパーは、リソース名を受け取り、そのリソース用のデータプロバイダーを返す関数をパラメーターとして受け取ります。</p>

<p>例えば、次のアプリは<code class="language-plaintext highlighter-rouge">posts</code>と<code class="language-plaintext highlighter-rouge">comments</code>リソースに<code class="language-plaintext highlighter-rouge">ra-data-simple-rest</code>を使用し、<code class="language-plaintext highlighter-rouge">user</code>リソースに<code class="language-plaintext highlighter-rouge">ra-data-local-storage</code>を使用します：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">buildRestProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-simple-rest</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">buildStorageProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-local-storage</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Admin</span><span class="p">,</span> <span class="nx">Resource</span><span class="p">,</span> <span class="nx">combineDataProviders</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">dataProvider1</span> <span class="o">=</span> <span class="nx">buildRestProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://path.to.my.api/</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">dataProvider2</span> <span class="o">=</span> <span class="nx">buildStorageProvider</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">combineDataProviders</span><span class="p">((</span><span class="nx">resource</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">resource</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">comments</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">return</span> <span class="nx">dataProvider1</span><span class="p">;</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">return</span> <span class="nx">dataProvider2</span><span class="p">;</span>
        <span class="nl">default</span><span class="p">:</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`Unknown resource: </span><span class="p">${</span><span class="nx">resource</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Admin</span> <span class="na">dataProvider</span><span class="p">=</span><span class="si">{</span><span class="nx">dataProvider</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Resource</span> <span class="na">name</span><span class="p">=</span><span class="s">"posts"</span> <span class="na">list</span><span class="p">=</span><span class="si">{</span><span class="nx">PostList</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">Resource</span> <span class="na">name</span><span class="p">=</span><span class="s">"comments"</span> <span class="na">list</span><span class="p">=</span><span class="si">{</span><span class="nx">CommentList</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">Resource</span> <span class="na">name</span><span class="p">=</span><span class="s">"users"</span> <span class="na">list</span><span class="p">=</span><span class="si">{</span><span class="nx">UserList</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nc">Admin</span><span class="p">&gt;</span>
<span class="p">);</span>
</code></pre></div></div>

<p>データプロバイダーの選択がリソース名だけに依存しない場合、またはリソース名を操作したい場合、JavaScriptの<code class="language-plaintext highlighter-rouge">Proxy</code>オブジェクトを使用してデータプロバイダーを手動で組み合わせます。</p>

<p>例えば、API選択を容易にするためにリソース名にプレフィックスを付けることができます：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">buildRestProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-simple-rest</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">buildStorageProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-local-storage</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Admin</span><span class="p">,</span> <span class="nx">Resource</span><span class="p">,</span> <span class="nx">defaultDataProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">dataProvider1</span> <span class="o">=</span> <span class="nx">buildRestProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://path.to.my.api/</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">dataProvider2</span> <span class="o">=</span> <span class="nx">buildStorageProvider</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Proxy</span><span class="p">(</span><span class="nx">defaultDataProvider</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">get</span><span class="p">:</span> <span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">symbol</span><span class="dl">'</span> <span class="o">||</span> <span class="nx">name</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">then</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">api1/</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dataProvider1</span><span class="p">[</span><span class="nx">name</span><span class="p">](</span><span class="nx">resource</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nx">params</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">api2/</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dataProvider2</span><span class="p">[</span><span class="nx">name</span><span class="p">](</span><span class="nx">resource</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nx">params</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Admin</span> <span class="na">dataProvider</span><span class="p">=</span><span class="si">{</span><span class="nx">dataProvider</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Resource</span> <span class="na">name</span><span class="p">=</span><span class="s">"api1/posts"</span> <span class="na">list</span><span class="p">=</span><span class="si">{</span><span class="nx">PostList</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">Resource</span> <span class="na">name</span><span class="p">=</span><span class="s">"api1/comments"</span> <span class="na">list</span><span class="p">=</span><span class="si">{</span><span class="nx">CommentList</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">Resource</span> <span class="na">name</span><span class="p">=</span><span class="s">"api2/users"</span> <span class="na">list</span><span class="p">=</span><span class="si">{</span><span class="nx">UserList</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nc">Admin</span><span class="p">&gt;</span>
<span class="p">);</span>
</code></pre></div></div>

<h2 id="react-queryオプション">React-Queryオプション</h2>

<p>react-adminは、データのフェッチ、キャッシュ、更新に<a href="https://react-query-v3.tanstack.com/">react-query</a>を使用します。内部的に、<code class="language-plaintext highlighter-rouge">&lt;Admin&gt;</code>コンポーネントはマウント時にreact-queryの<a href="https://tanstack.com/query/v3/docs/react/reference/QueryClient"><code class="language-plaintext highlighter-rouge">QueryClient</code></a>を作成し、<a href="https://react-query-v3.tanstack.com/guides/important-defaults">react-queryの「攻撃的だが理にかなっている」デフォルト</a>を使用します：</p>

<ul>
  <li>クエリはキャッシュされたデータを古いと見なします</li>
  <li>古いクエリは以下の場合にバックグラウンドで自動的に再フェッチされます：
    <ul>
      <li>クエリの新しいインスタンスがマウントされたとき</li>
      <li>ウィンドウがフォーカスされたとき</li>
      <li>ネットワークが再接続されたとき</li>
      <li>クエリがオプションで再フェッチ間隔で設定されている場合</li>
    </ul>
  </li>
  <li>現在のページで使用されていないクエリ結果は「非アクティブ」とラベル付けされ、後で再度使用される場合に備えてキャッシュに残ります</li>
  <li>デフォルトでは、「非アクティブ」なクエリは5分後にガベージコレクションされます</li>
  <li>失敗したクエリはサイレントに3回再試行され、指数バックオフ遅延後にUIにエラーを表示します</li>
  <li>クエリ結果はデフォルトで構造的に共有され、データが実際に変更されたかどうかを検出し、そうでない場合はデータ参照が変更されず、<code class="language-plaintext highlighter-rouge">useMemo</code>や<code class="language-plaintext highlighter-rouge">useCallback</code>に関する値の安定化が向上します。</li>
</ul>

<p>react-queryのデフォルトクエリおよびミューテーションデフォルトオプションを上書きしたり、特定のクライアントやミューテーションキャッシュを使用したりする場合は、独自の<code class="language-plaintext highlighter-rouge">QueryClient</code>インスタンスを作成し、<code class="language-plaintext highlighter-rouge">&lt;Admin queryClient&gt;</code>プロップに渡すことができます：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Admin</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">QueryClient</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-query</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">queryClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QueryClient</span><span class="p">({</span>
    <span class="na">defaultOptions</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">queries</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">retry</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">structuralSharing</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="na">mutations</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">retryDelay</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Admin</span> <span class="na">queryClient</span><span class="p">=</span><span class="si">{</span><span class="nx">queryClient</span><span class="si">}</span> <span class="na">dataProvider</span><span class="p">=</span><span class="si">{</span><span class="p">...</span><span class="si">}</span><span class="p">&gt;</span>
        ...
    <span class="p">&lt;/</span><span class="nc">Admin</span><span class="p">&gt;</span>
<span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">QueryClient</code>コンストラクタに渡すオプションについては、<a href="https://tanstack.com/query/v3/docs/react/reference/QueryClient">react-queryのドキュメント</a>および<a href="https://tanstack.com/query/v3/docs/react/reference/useQuery">クエリオプション</a>と<a href="https://tanstack.com/query/v3/docs/react/reference/useMutation">ミューテーションオプション</a>セクションを確認してください。</p>

<p>react-adminの開発者がよく上書きする設定は次のとおりです：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">QueryClient</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-query</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">queryClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QueryClient</span><span class="p">({</span>
    <span class="na">defaultOptions</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">queries</span><span class="p">:</span> <span class="p">{</span>
            <span class="cm">/**
             * データが古いと見なされるまでの時間（ミリ秒単位）。
             * `Infinity`に設定すると、データは古いと見なされません。
             */</span>
            <span class="na">staleTime</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
            <span class="cm">/**
             * `false`に設定すると、失敗したクエリはデフォルトで再試行されません。
             * `true`に設定すると、失敗したクエリは無限に再試行されます。
             * 整数（例：3）に設定すると、失敗したクエリは失敗回数がその数に達するまで再試行されます。
             * `(failureCount, error) =&gt; boolean`の関数に設定すると、関数がfalseを返すまで失敗したクエリが再試行されます。
             */</span>
            <span class="na">retry</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="cm">/**
             * `true`に設定すると、データが古い場合、ウィンドウフォーカス時にクエリが再フェッチされます。
             * `false`に設定すると、クエリはウィンドウフォーカス時に再フェッチされません。
             * `always`に設定すると、クエリはウィンドウフォーカス時に常に再フェッチされます。
             * 関数に設定すると、最新のデータとクエリを使用して値を計算するために関数が実行されます。
             * デフォルトは`true`です。
             */</span>
            <span class="na">refetchOnWindowFocus</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="データプロバイダーの呼び出し">データプロバイダーの呼び出し</h2>

<p>独自のReactコンポーネントからデータプロバイダーを直接呼び出し、react-queryの<code class="language-plaintext highlighter-rouge">useQuery</code>と<code class="language-plaintext highlighter-rouge">useMutation</code>フックを組み合わせて使用できます。ただし、これは非常に一般的なユースケースであるため、react-adminはデータプロバイダーメソッドごとにフックを提供しています。</p>

<p>例えば、<code class="language-plaintext highlighter-rouge">dataProvider.getOne()</code>を呼び出すには、<code class="language-plaintext highlighter-rouge">useGetOne</code>フックを使用します：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">useGetOne</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Loading</span><span class="p">,</span> <span class="nb">Error</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./MyComponents</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">UserProfile</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">userId</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">isLoading</span><span class="p">,</span> <span class="nx">error</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useGetOne</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">userId</span> <span class="p">});</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span> <span class="k">return</span> <span class="p">&lt;</span><span class="nc">Loading</span> <span class="p">/&gt;;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="p">&lt;</span><span class="nc">Error</span> <span class="p">/&gt;;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Name: <span class="si">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Email: <span class="si">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">)</span>
<span class="p">};</span>
</code></pre></div></div>

<p><a href="./Actions.md">APIのクエリ</a>ドキュメントには、APIをクエリするためのフック、およびそれらのオプションと戻り値のすべてがリストされています。</p>

<h2 id="ファイルアップロードの処理">ファイルアップロードの処理</h2>

<p>ユーザーがファイル入力を含むフォームを送信すると、データプロバイダーメソッド（<code class="language-plaintext highlighter-rouge">create</code>または<code class="language-plaintext highlighter-rouge">update</code>）は<a href="https://developer.mozilla.org/en-US/docs/Web/API/File">ファイルオブジェクト</a>を受け取ります。この<code class="language-plaintext highlighter-rouge">File</code>オブジェクトを使用して、サーバーが期待する形式でファイルを送信できます：</p>

<ul>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader"><code class="language-plaintext highlighter-rouge">FileReader</code></a> APIを使用して、<a href="#sending-files-in-base64">Base64文字列としてファイルを送信</a>できます。</li>
  <li>レコードデータとそのファイルを1つのクエリで送信する<a href="#sending-files-in-multipartform-data">multipart/form-dataを使用してファイルを送信</a>できます。</li>
  <li>または、<a href="#sending-files-to-a-third-party-service">CDNなどのサードパーティサービスにファイルを送信</a>することもできます。</li>
  <li>その他。</li>
</ul>

<h3 id="base64でファイルを送信する">Base64でファイルを送信する</h3>

<p>以下のデータプロバイダーは、<code class="language-plaintext highlighter-rouge">dataProvider.update('posts')</code>に渡された画像をBase64文字列に変換する既存のデータプロバイダーを拡張します。この例では、<code class="language-plaintext highlighter-rouge">withLifecycleCallbacks</code>を活用して、<code class="language-plaintext highlighter-rouge">posts</code>リソースのみの<code class="language-plaintext highlighter-rouge">dataProvider.update()</code>メソッドを変更しています。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">withLifecycleCallbacks</span><span class="p">,</span> <span class="nx">DataProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-admin</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">simpleRestProvider</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ra-data-simple-rest</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">withLifecycleCallbacks</span><span class="p">(</span><span class="nx">simpleRestProvider</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://path.to.my.api/</span><span class="dl">'</span><span class="p">),</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="cm">/**
         * 投稿の更新のみ、アップロードされた画像をbase64に変換し、
         * それらを`src`および`title`属性を持つ`picture`送信プロパティに添付します。
         */</span>
        <span class="na">resource</span><span class="p">:</span> <span class="dl">'</span><span class="s1">posts</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">beforeUpdate</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="na">params</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="na">dataProvider</span><span class="p">:</span> <span class="nx">DataProvider</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="c1">// 新しくドロップされた画像はFileオブジェクトであり、base64文字列に変換する必要があります</span>
            <span class="kd">const</span> <span class="nx">newPictures</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">pictures</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span>
                <span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">rawFile</span> <span class="k">instanceof</span> <span class="nx">File</span>
            <span class="p">);</span>
            <span class="kd">const</span> <span class="nx">formerPictures</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">pictures</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span>
                <span class="nx">p</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">rawFile</span> <span class="k">instanceof</span> <span class="nx">File</span><span class="p">)</span>
            <span class="p">);</span>

            <span class="kd">const</span> <span class="nx">base64Pictures</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span>
                <span class="nx">newPictures</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">convertFileToBase64</span><span class="p">)</span>
            <span class="p">)</span>
            
            <span class="kd">const</span> <span class="nx">pictures</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">...</span><span class="nx">base64Pictures</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">dataUrl</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
                    <span class="na">src</span><span class="p">:</span> <span class="nx">dataUrl</span><span class="p">,</span>
                    <span class="na">title</span><span class="p">:</span> <span class="nx">newPictures</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">name</span><span class="p">,</span>
                <span class="p">})),</span>
                <span class="p">...</span><span class="nx">formerPictures</span><span class="p">,</span>
            <span class="p">];</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">params</span><span class="p">,</span>
                <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
                    <span class="p">...</span><span class="nx">params</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
                    <span class="nx">pictures</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">};</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">]);</span>

<span class="cm">/**
 * アップロード入力から返された`File`オブジェクトをbase64文字列に変換します。
 * これは、製品で画像を保存するための最適な方法ではありませんが、
 * データプロバイダーの装飾のアイデアを示すのに十分です。
 */</span>
<span class="kd">const</span> <span class="nx">convertFileToBase64</span> <span class="o">=</span> <span class="nx">file</span> <span class="o">=&gt;</span>
    <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>
        <span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">reader</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
        <span class="nx">reader</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="nx">reject</span><span class="p">;</span>
        <span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">rawFile</span><span class="p">);</span>
    <span class="p">});</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">myDataProvider</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>ヒント</strong>: <code class="language-plaintext highlighter-rouge">create</code>と<code class="language-plaintext highlighter-rouge">update</code>の両方の呼び出しについて同じことを行うには、<code class="language-plaintext highlighter-rouge">beforeUpdate</code>の代わりに<code class="language-plaintext highlighter-rouge">beforeSave</code>を使用します。</p>

<h3 id="multipartform-dataでファイルを送信する"><code class="language-plaintext highlighter-rouge">multipart/form-data</code>でファイルを送信する</h3>

<p>HTMLフォームのように、APIにファイルをアップロードする必要がある場合、<a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData">FormData</a> APIを使用できます。これは、エンコーディングタイプが<code class="language-plaintext highlighter-rouge">multipart/form-data</code>に設定された場合のフォームが使用する形式と同じです。</p>

<p>次のデータプロバイダーは、既存のものを拡張し、<code class="language-plaintext highlighter-rouge">posts</code>リソースのみの<code class="language-plaintext highlighter-rouge">create</code>および<code class="language-plaintext highlighter-rouge">update</code>メソッドを調整します。APIがリクエストを交渉し、画像を処理する役割です。</p>

<p>データプロバイダーは、<code class="language-plaintext highlighter-rouge">post</code>データと添付ファイルを1つのクエリで送信し、次のように機能します：</p>

<ul>
  <li>リソースが<code class="language-plaintext highlighter-rouge">posts</code>であるかどうかを確認します。</li>
  <li>そうであれば、フォームから受け取った<code class="language-plaintext highlighter-rouge">post</code>データとファイルで新しい<code class="language-plaintext highlighter-rouge">FormData</code>オブジェクトを作成します。</li>
  <li>この<code class="language-plaintext highlighter-rouge">FormData</code>をAPIにreact-adminの<a href="./fetchJson.md"><code class="language-plaintext highlighter-rouge">fetchUtils.fetchJson()</code></a>関数を使用して送信します。</li>
  <li>リソースが<code class="language-plaintext highlighter-rouge">posts</code>以外の場合、単に<code class="language-plaintext highlighter-rouge">baseDataProvider</code>のベースメソッドを使用します。</li>
</ul>

<p>見てみましょう：</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">simpleRestDataProvider</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">ra-data-simple-rest</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">CreateParams</span><span class="p">,</span>
  <span class="nx">UpdateParams</span><span class="p">,</span>
  <span class="nx">DataProvider</span><span class="p">,</span>
  <span class="nx">fetchUtils</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-admin</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://path.to.my.api</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">baseDataProvider</span> <span class="o">=</span> <span class="nx">simpleRestDataProvider</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">);</span>

<span class="kd">type</span> <span class="nx">PostParams</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">title</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">content</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">picture</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rawFile</span><span class="p">:</span> <span class="nx">File</span><span class="p">;</span>
    <span class="nl">src</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">title</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">createPostFormData</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">params</span><span class="p">:</span> <span class="nx">CreateParams</span><span class="o">&lt;</span><span class="nx">PostParams</span><span class="o">&gt;</span> <span class="o">|</span> <span class="nx">UpdateParams</span><span class="o">&lt;</span><span class="nx">PostParams</span><span class="o">&gt;</span>
<span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">picture</span><span class="p">?.</span><span class="nx">rawFile</span> <span class="o">&amp;&amp;</span> <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">file</span><span class="dl">"</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">picture</span><span class="p">.</span><span class="nx">rawFile</span><span class="p">);</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">title</span> <span class="o">&amp;&amp;</span> <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">content</span> <span class="o">&amp;&amp;</span> <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">content</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">formData</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">dataProvider</span><span class="p">:</span> <span class="nx">DataProvider</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">baseDataProvider</span><span class="p">,</span>
  <span class="na">create</span><span class="p">:</span> <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">posts</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">formData</span> <span class="o">=</span> <span class="nx">createPostFormData</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">fetchUtils</span>
        <span class="p">.</span><span class="nx">fetchJson</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">resource</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">body</span><span class="p">:</span> <span class="nx">formData</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(({</span> <span class="nx">json</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="na">data</span><span class="p">:</span> <span class="nx">json</span> <span class="p">}));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">baseDataProvider</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="na">update</span><span class="p">:</span> <span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">posts</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">formData</span> <span class="o">=</span> <span class="nx">createPostFormData</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
      <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">fetchUtils</span>
        <span class="p">.</span><span class="nx">fetchJson</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">resource</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PUT</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">body</span><span class="p">:</span> <span class="nx">formData</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(({</span> <span class="nx">json</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="na">data</span><span class="p">:</span> <span class="nx">json</span> <span class="p">}));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">baseDataProvider</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="サードパーティサービスへのファイル送信">サードパーティサービスへのファイル送信</h3>

<p>シングルページアプリケーションでファイルアップロードを処理する一般的な方法は、最初に<a href="https://cloudinary.com/">Cloudinary</a>や<a href="https://www.cloudimage.io/en/home">CloudImage</a>などのCDNにファイルをアップロードし、CDNが生成したファイルURLをレコード作成/変更ペイロードに使用することです。</p>

<p><a href="https://cloudinary.com/">Cloudinary</a>サービスを例にとって、彼らの<a href="https://cloudinary.com/documentation/upload_images#authenticated_requests">“Authenticated requests” example</a>に従って<code class="language-plaintext highlighter-rouge">dataProvider</code>を適応させる方法を見てみましょう。</p>

<p>これを行うためには、Cloudinaryが期待する形式の<a href="https://cloudinary.com/documentation/upload_images#generating_authentication_signatures"><code class="language-plaintext highlighter-rouge">署名</code></a>を提供するAPIが必要です。これを容易にするために<a href="https://cloudinary.com/documentation/node_integration#installation_and_setup"><code class="language-plaintext highlighter-rouge">cloudinary</code>パッケージ</a>をインストールできます。</p>

<p>次の例は、ファイルをCloudinaryに送信するために必要な署名を生成して提供するものです。Remixを使用しています：</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// "get-cloudinary-signature"ルートを処理し、セキュリティ保護する必要があります</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">LoaderFunctionArgs</span><span class="p">,</span> <span class="nx">json</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@remix-run/node</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">cloudinary</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">cloudinary</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">loader</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">request</span> <span class="p">}:</span> <span class="nx">LoaderFunctionArgs</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">cloudinary</span><span class="p">.</span><span class="nx">v2</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
    <span class="na">api_key</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CLOUDINARY_API_KEY</span><span class="p">,</span>
    <span class="na">api_secret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CLOUDINARY_API_SECRET</span><span class="p">,</span>
    <span class="na">cloud_name</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CLOUDINARY_CLOUD_NAME</span><span class="p">,</span>
    <span class="na">secure</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">cloudinary</span><span class="p">.</span><span class="nx">v2</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">api_sign_request</span><span class="p">(</span>
    <span class="p">{</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="nx">timestamp</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CLOUDINARY_API_SECRET</span> <span class="k">as</span> <span class="kr">string</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="nx">json</span><span class="p">({</span>
    <span class="nx">timestamp</span><span class="p">,</span>
    <span class="nx">signature</span><span class="p">,</span>
    <span class="na">cloud_name</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CLOUDINARY_CLOUD_NAME</span><span class="p">,</span>
    <span class="na">api_key</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CLOUDINARY_API_KEY</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">};</span>
</code></pre></div></div>

<p>次のデータプロバイダーは、既存のものを拡張し、<a href="#adding-lifecycle-callbacks"><code class="language-plaintext highlighter-rouge">withLifecycleCallbacks</code></a>を活用して、<code class="language-plaintext highlighter-rouge">posts</code>リソースのみの<code class="language-plaintext highlighter-rouge">dataProvider.create()</code>および<code class="language-plaintext highlighter-rouge">dataProvider.update()</code>メソッドを<a href="./withLifecycleCallbacks.md#beforesave"><code class="language-plaintext highlighter-rouge">beforeSave</code></a>メソッドで変更します。</p>

<p>次のように動作します：</p>

<ul>
  <li>Cloudinaryの署名を取得してリクエストの認証を許可します。</li>
  <li>フォームから受け取ったファイルで新しい<code class="language-plaintext highlighter-rouge">FormData</code>オブジェクトを作成します。</li>
  <li>このファイルをCloudinary APIに送信します。</li>
  <li>Cloudinaryから送信されたデータで<code class="language-plaintext highlighter-rouge">params.picture</code>オブジェクトを埋めます。</li>
  <li>親データプロバイダーがそのプロセスを実行できるように<code class="language-plaintext highlighter-rouge">params</code>オブジェクトを返します。</li>
</ul>

<p>例を見てみましょう：</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// dataProvider.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">DataProvider</span><span class="p">,</span> <span class="nx">withLifecycleCallbacks</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-admin</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">simpleRestProvider</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">ra-data-simple-rest</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">CloudinaryFile</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">asset_id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">secure_url</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">type</span> <span class="nx">SignData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">api_key</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">timestamp</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">signature</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">cloud_name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://path.to.my.api</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">withLifecycleCallbacks</span><span class="p">(</span>
  <span class="nx">simpleRestProvider</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">),</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">resource</span><span class="p">:</span> <span class="dl">"</span><span class="s2">posts</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">beforeSave</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="na">params</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="na">dataProvider</span><span class="p">:</span> <span class="nx">DataProvider</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span>
          <span class="s2">`</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">/get-cloudinary-signature`</span><span class="p">,</span>
          <span class="p">{</span> <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span> <span class="p">}</span>
          <span class="c1">// 正しい認証情報でヘッダーを送信する必要があります</span>
        <span class="p">);</span>

        <span class="kd">const</span> <span class="na">signData</span><span class="p">:</span> <span class="nx">SignData</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

        <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`https://api.cloudinary.com/v1_1/</span><span class="p">${</span><span class="nx">signData</span><span class="p">.</span><span class="nx">cloud_name</span><span class="p">}</span><span class="s2">/auto/upload`</span><span class="p">;</span>

        <span class="kd">const</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
        <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">file</span><span class="dl">"</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">picture</span><span class="p">.</span><span class="nx">rawFile</span><span class="p">);</span>
        <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">api_key</span><span class="dl">"</span><span class="p">,</span> <span class="nx">signData</span><span class="p">.</span><span class="nx">api_key</span><span class="p">);</span>
        <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">,</span> <span class="nx">signData</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">);</span>
        <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">signature</span><span class="dl">"</span><span class="p">,</span> <span class="nx">signData</span><span class="p">.</span><span class="nx">signature</span><span class="p">);</span>

        <span class="kd">const</span> <span class="nx">imageResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">body</span><span class="p">:</span> <span class="nx">formData</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="kd">const</span> <span class="na">image</span><span class="p">:</span> <span class="nx">CloudinaryFile</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">imageResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

        <span class="k">return</span> <span class="p">{</span>
          <span class="p">...</span><span class="nx">params</span><span class="p">,</span>
          <span class="na">picture</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">src</span><span class="p">:</span> <span class="nx">image</span><span class="p">.</span><span class="nx">secure_url</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="nx">image</span><span class="p">.</span><span class="nx">asset_id</span><span class="p">,</span>
          <span class="p">},</span>
        <span class="p">};</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">]</span>
<span class="p">);</span>
</code></pre></div></div>

<p>詳細については、<a href="https://cloudinary.com/documentation/programmable_media_overview">Cloudinaryのスタートガイド</a>を参照してください。</p>


                        </div>
                    </div>
                    <div class="col hide-on-small-only m3 toc-container">
                        <div class="toc"></div>
                    </div>
                </div>
            </div>
        </main>

        <script src="/js/materialize.min.js"></script>
        <script src="/js/prism.js"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.js"
            defer
            integrity="sha512-oD3xGN8YTxenx6tdS4D/RKqO4OtORBQtAb2/FseM17GGMIi6jMwKUBc8duX4A5RwMOGGXoFBZrsqbOk8GpXFgQ=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <script src="/js/ra-doc-exec.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
        
        <script type="text/javascript">
            docsearch({
                container: '#docsearch',
                appId: 'QY9T9CVM2N',
                indexName: 'marmelab-react-admin',
                apiKey: '75332227370be3dc35777cee6244881a',
                searchParameters: { facetFilters: ['version:  latest'] },
            });
        </script>

        <!--
        React-admin protects your privacy!
        We use our own self-hosted tracking solution to collect some raw metrics,
        like page views, device type (mobile, desktop, etc.) or country.
        We don't track any personal information about our visitors.
    -->
        <script
            async
            defer
            data-website-id="ef7f8242-2808-4cbf-9dff-564daa515bbd"
            src="https://analytics.marmelab.com/umami.js"
        ></script>

        <!-- Newsletter form -->
        <script>
            window.REQUIRED_CODE_ERROR_MESSAGE = 'Please choose a country code';
            window.LOCALE = 'en';
            window.GENERIC_INVALID_MESSAGE = window.EMAIL_INVALID_MESSAGE = window.SMS_INVALID_MESSAGE =
                'The information provided is invalid. Please review the field format and try again.';
            window.REQUIRED_ERROR_MESSAGE = 'This field is required.';

            var AUTOHIDE = Boolean(0);
        </script>

        <script
            async
            defer
            src="https://unpkg.com/typescript@5.1.3/lib/typescript.js"
        ></script>
        <script
            async
            defer
            src="https://unpkg.com/prettier@2.8.8/standalone.js"
        ></script>
        <script
            async
            defer
            src="https://unpkg.com/prettier@2.8.8/parser-babel.js"
        ></script>
    </body>
</html>
